<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HR Assistant</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
        }
        /* Main chat container adjustments */
        .chat-box-container {
            display: flex;
            flex-direction: column;
            height: calc(100vh - 40px); /* Adjust height to fit better within typical viewports, accounting for some margin/padding */
            max-height: 800px; /* Optional: set a max height for very large screens */
        }
        .chat-messages-area {
            flex-grow: 1; /* Allow message area to take up available space */
            overflow-y: auto; /* Make message area scrollable */
            padding: 0 10px; /* Add horizontal padding inside the scroll area */
            margin-bottom: 15px; /* Space between messages area and input */
        }
        .message-container {
             /* Container for individual messages to handle alignment */
            display: flex;
            margin-bottom: 10px; /* Space between messages */
        }
        .user-message-container {
            justify-content: flex-end;
        }
        .bot-message-container {
            justify-content: flex-start;
        }
        .message {
            max-width: 80%;
            padding: 12px 18px; /* Increased padding */
            border-radius: 20px; /* More rounded corners */
            line-height: 1.5; /* Improved readability */
            word-wrap: break-word; /* Prevent long words from overflowing */
        }
        .user-message {
            background-color: #3B82F6; /* Blue */
            color: white;
        }
        .bot-message {
            background-color: #E5E7EB; /* Light gray */
            color: #1F2937; /* Dark gray text */
        }
         #question-form {
            padding-top: 10px; /* Space above the input form */
        }
         #question {
            border-color: #D1D5DB; /* Gray border */
        }
         #question:focus {
            border-color: #3B82F6; /* Blue focus ring */
            box-shadow: 0 0 0 1px #3B82F6; /* Blue shadow */
        }
         button[type="submit"] {
            transition: background-color 0.2s ease-in-out; /* Smooth hover transition */
        }
         /* Style for the options container */
        .message-options {
            display: flex;
            flex-direction: column;
            gap: 8px; /* Space between buttons */
            margin-top: 8px; /* Space above options */
        }
         .message-options button {
            /* Inherits button styling, can add more specifics if needed */
         }
    </style>
</head>
<body class="bg-gray-100 font-sans">
    <div class="container mx-auto p-6 max-w-2xl">
        <div class="bg-white rounded-xl shadow-lg p-6 chat-box-container">
            <h1 class="text-2xl font-semibold text-center text-gray-800 mb-6">HR Assistant</h1>
            
            <div id="chat" class="chat-messages-area mb-6">
                <!-- Messages will be added here -->
            </div>

            <form id="question-form" class="flex gap-3">
                <input
                    type="text"
                    id="question"
                    placeholder="Ask an HR question..."
                    class="flex-1 p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                    autocomplete="off"
                >
                <button
                    type="submit"
                    class="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"
                >
                    Send
                </button>
            </form>
        </div>
    </div>

    <script>
        const chat = document.getElementById('chat');
        const form = document.getElementById('question-form');
        const input = document.getElementById('question');
        const sessionId = "{{ session_id }}"; // Get session ID from Flask

        function addMessage(text, isUser, isOptions = false, options = []) {
            const messageContainer = document.createElement('div');
            messageContainer.className = `message-container ${isUser ? 'user-message-container' : 'bot-message-container'}`;
            
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${isUser ? 'user-message' : 'bot-message'}`;

            if (isOptions) {
                messageDiv.innerHTML = `<p class="mb-2">${text}</p>`;
                const optionsContainer = document.createElement('div');
                optionsContainer.className = "message-options";
                options.forEach(option => {
                    const optionButton = document.createElement('button');
                    optionButton.textContent = option;
                    optionButton.className = "block w-full text-left px-4 py-2 mt-2 text-sm font-medium text-blue-700 bg-blue-100 rounded-lg hover:bg-blue-200 focus:outline-none focus:ring-2 focus:ring-blue-500";
                    optionButton.onclick = () => handleOptionClick(option);
                    optionsContainer.appendChild(optionButton);
                });
                messageDiv.appendChild(optionsContainer);
            } else {
                messageDiv.textContent = text;
            }

            messageContainer.appendChild(messageDiv);
            chat.appendChild(messageContainer);
            chat.scrollTop = chat.scrollHeight;
        }

        async function handleOptionClick(option) {
            // Add user's selected option as a message
            addMessage(option, true);

            // Clear options from the bot's message (optional, but can make it cleaner)
            const lastBotMessage = chat.lastChild.querySelector('.bot-message');
            if(lastBotMessage && lastBotMessage.querySelector('.message-options')) {
                lastBotMessage.querySelector('.message-options').remove();
            }

            try {
                // Send the selected option to the backend
                const response = await fetch('/ask', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ question: option, session_id: sessionId }),
                });
                const data = await response.json();
                
                // Process bot's response (could be a final answer or another follow-up)
                setTimeout(() => {
                    if (data.follow_up_question && data.follow_up_options) {
                        addMessage(data.follow_up_question, false, true, data.follow_up_options);
                    } else {
                        addMessage(data.answer, false);
                    }
                }, 500);
            } catch (error) {
                addMessage('Sorry, I encountered an error processing your option. Please try again.', false);
            }
        }

        // Add initial bot messages with topics
        addMessage("Hello! How can I assist you with your HR questions today?", false);
        setTimeout(() => {
            addMessage("You can ask me about: Leave, Benefits, Payroll, Remote work, Expenses, Insurance, Training, PTO, Sick leave, or Maternity leave.", false);
        }, 800);

        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            const question = input.value.trim();
            if (!question) return;

            // Add user message
            addMessage(question, true);
            input.value = '';

            try {
                // Get bot response
                const response = await fetch('/ask', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ question: question, session_id: sessionId }), // Include session_id
                });
                const data = await response.json();
                
                // Add bot response with slight delay
                setTimeout(() => {
                    if (data.follow_up_question && data.follow_up_options) {
                        addMessage(data.follow_up_question, false, true, data.follow_up_options);
                    } else {
                        addMessage(data.answer, false);
                    }
                }, 500);
            } catch (error) {
                addMessage('Sorry, I encountered an error. Please try again.', false);
            }
        });
    </script>
</body>
</html> 